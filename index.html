<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <link rel="stylesheet" href="css/video-js.css" />
        <link rel="stylesheet" href="css/default.css" />
        <title>Knox County TN Traffic Center</title>
        <script type="text/javascript" src="js/support.js"></script>
        <script type="text/javascript">
            const queryString = window.location.search;
            const urlParams = new URLSearchParams(queryString);
            var showAll = null;
            var showcase = null;

            calcMaxPlayers();
            function startPlayers() {
                videojs.options.controls = false;
                videojs.options.autoplay = 'muted';
                videojs.options.preload = 'auto';
                videojs.options.width = width;
                videojs.options.height = height;
                if (showcase !== null) {
                    loadShowcase(showcase);
                } else {
                    loadMain();
                }
            }

            function addVideo(id, region, scale) {
                var video = document.createElement("video-js");
                video.id = 'video' + id;
                var source = document.createElement("source");
                // Build source string
                var srcStr = "https://mcleansfs";
                if (id <= 9)
                    srcStr = srcStr + "5";
                else if (id <= 19)
                    srcStr = srcStr + "1";
                else if (id <= 29)
                    srcStr = srcStr + "2";
                else if (id <= 39)
                    srcStr = srcStr + "3";
                else if (id <= 49)
                    srcStr = srcStr + "4";
                else if (id <= 59)
                    srcStr = srcStr + "5";
                else if (id === 70 || id === 71 || id === 72 || id === 73 || id === 74 || id === 75)
                    srcStr = srcStr + "2";
                else if (id === 100 || id === 101)
                    srcStr = srcStr + "2";
                else if (id === 79 || id === 80 || id === 82 || id === 93)
                    srcStr = srcStr + "3";
                else if (id === 84)
                    srcStr = srcStr + "5";
                else if (id >= 206 && id <= 210)
                    srcStr = srcStr + "3";
                else if (id === 86 || id === 87)
                    srcStr = srcStr + "2";
                else
                    srcStr = srcStr + "1";
                srcStr = srcStr + ".us-east-1.skyvdn.com/rtplive/R1_";
                if (id < 100)
                    srcStr = srcStr + "0";
                if (id < 10)
                    srcStr = srcStr + "0";
                srcStr = srcStr + id;
                srcStr = srcStr + "/playlist.m3u8";
                source.src = srcStr;
                video.appendChild(source);
                if (region === "showcase")
                    video.onclick = function () {
                        showcase = null;
                        clearAll();
                        loadMain();
                    };
                else
                    video.onclick = function () {
                        showcase = id;
                        clearAll();
                        loadShowcase(id);
                    };
                if (typeof region === 'undefined') {
                    var mainDiv = document.getElementById('main');
                    mainDiv.appendChild(video);
                    videojs('video' + id);
                } else {
                    var div = document.getElementById(region);
                    div.appendChild(video);
                    videojs('video' + id, {width: width * scale, height: height * scale});
                }
            }

            function clearAll() {
                clearDiv("main");
                clearDiv("top");
                clearDiv("showcase");
                clearDiv("right");
            }

            function clearDiv(divID) {
                var div = document.getElementById(divID);
                var nodes = div.childNodes;
                while (nodes.length > 0) {
                    destroyNode(nodes[0]);
                }
            }

            function destroyNode(node) {
                if (node.nodeName === 'VIDEO-JS') {
                    videojs(node.id).dispose();
                } else {
                    node.remove();
                }
            }

            function resize() {
                if (showAll !== null) {
                    return;
                }

                clearAll();
                calcMaxPlayers();
                startPlayers();
            }
        </script>
    </head>
    <body onLoad="startPlayers()" onResize="resize()">
        <iframe id="incidents" src="https://smartway.tn.gov/traffic/text/region/1/incidents" sandbox="allow-scripts allow-same-origin"></iframe>
        <h1>Knox County TN Traffic Center</h1>
        <button id="showAll" onClick="clearAll();
                showAllCams();">Show all cams</button>
        <div id="video-wrapper">
            <div id="main"></div>
            <div id="left">
                <div id="top">
                </div>
                <div id="showcase">
                </div>
            </div>

            <div id="right">
            </div>

            <div id="bottom">
            </div>
        </div>

        <script src="js/video.min.js"></script>
    </body>
