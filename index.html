<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <link rel="stylesheet" href="css/video-js.css" />
        <link rel="stylesheet" href="css/default.css" />
        <title>Knox County TN Traffic Center</title>
        <script>
            var maxHeight = 240;
            var maxWidth = maxHeight * 3 / 2;
            console.log('innerWidth: ' + window.innerWidth);
            var numVidsWide = Math.floor(window.innerWidth * .8 / maxWidth);
            console.log('Vids Wide: ' + numVidsWide);
            var numVidsTall = Math.floor((window.innerHeight - 70) / maxHeight);
            console.log('Vids Tall: ' + numVidsTall);
            var maxVids = numVidsWide * numVidsTall;
            console.log('Max Videos: ' + maxVids);

            const queryString = window.location.search;
            const urlParams = new URLSearchParams(queryString);
            var showAll = urlParams.get('all');
            var test = urlParams.get('test');
            var showcase = urlParams.get('showcase');

            if (maxVids > 20 && showAll === null) {
                maxVids = 20;

                if (numVidsWide > 5 && numVidsTall >= 4) {
                    numVidsWide = 5;
                    numVidsTall = 4;
                }
                if (numVidsTall > 4 && numVidsWide >= 5) {
                    numVidsWide = 5;
                    numVidsTall = 4;
                }
                if (numVidsWide > 4 && numVidsTall >= 5) {
                    numVidsWide = 4;
                    numVidsTall = 5;
                }
                if (numVidsTall > 5 && numVidsWide >= 4) {
                    numVidsWide = 4;
                    numVidsTall = 5;
                }

                console.log('Vids Wide: ' + numVidsWide);
                console.log('Vids Tall: ' + numVidsTall);
                console.log('Max Videos: ' + maxVids);
            }
            var width = window.innerWidth * .8 / numVidsWide;
            var height = width * 2 / 3;
            var altHeight = (window.innerHeight - 70) / numVidsTall;
            var altWidth = altHeight * 3 / 2;
            if (altWidth < width) {
                width = altWidth;
                height = altHeight;
            }


            function startPlayers() {
                videojs.options.controls = false;
                videojs.options.autoplay = 'muted';
                videojs.options.preload = 'auto';
                videojs.options.width = width;
                videojs.options.height = height;

                if (showAll !== null) {
                    var incidents = document.getElementById('incidents');
                    incidents.style.display = 'none';
                    var i;
                    for (i = 1; i <= 93; i++) {
                        addSnapshot(i);
                    }
                    for (i = 206; i <= 210; i++) {
                        addSnapshot(i);
                    }
                    addSnapshot(100);
                    addSnapshot(101);
                } else if (showcase !== null) {
                    numVidsWide = 5;
                    numVidsTall = 4;

                    if (maxVids > 12)
                        maxVids = 12;
                    width = window.innerWidth * .8 / numVidsWide;
                    height = width * 2 / 3;
                    altHeight = (window.innerHeight - 70) / numVidsTall;
                    altWidth = altHeight * 3 / 2;
                    if (altWidth < width) {
                        width = altWidth;
                        height = altHeight;
                    }

                    var support1;
                    var support2;
                    var video1;
                    var video2;
                    var video3;

                    if (showcase === 3) {
                        support1 = 2;
                        support2 = 70;
                    } else if (showcase === 4) {
                        support1 = 70;
                        support2 = 5;
                    } else if (showcase === 70) {
                        support1 = 3;
                        support2 = 4;
                    } else if ((showcase >= 2 && showcase <= 31) || (showcase >= 34 && showcase <= 51) || (showcase >= 54 && showcase <= 56) || (showcase >= 60 && showcase <= 65) || (showcase === 68) || (showcase === 72) || (showcase >= 77 && showcase <= 83) || (showcase >= 86 && showcase <= 88) || (showcase >= 91 && showcase <= 92) || (showcase >= 207 && showcase <= 209)) {
                        support1 = parseInt(showcase) - 1;
                        support2 = parseInt(showcase) + 1;
                    } else if (showcase === 1 || showcase === 33 || showcase === 53 || showcase === 58 || showcase === 67 || showcase === 76 || showcase === 84 || showcase === 90 || showcase === 100 || showcase === 71 || showcase === 59 || showcase === 206) {
                        support1 = parseInt(showcase) + 1;
                        if (showcase === 88) {
                            support2 = support1;
                            support1 = parseInt(showcase) - 3;
                        } else if (showcase === 71) {
                            support2 = support1;
                            support1 = parseInt(showcase) - 2;
                        } else if (showcase === 58) {
                            support1 = 21;
                            support2 = 75;
                        } else if (showcase === 59) {
                            support2 = support1;
                            support1 = 75;
                        }
                    } else if (showcase === 32 || showcase === 52 || showcase === 57 || showcase === 66 || showcase === 69 || showcase === 89 || showcase === 93 || showcase === 101 || showcase === 73 || showcase === 210) {
                        support1 = parseInt(showcase) - 1;
                        if (showcase === 69) {
                            support2 = parseInt(showcase) + 2;
                        } else if (showcase === 57) {
                            support2 = 18;
                        }
                    } else if (showcase === 85) {
                        support1 = parseInt(showcase) - 2;
                        support2 = parseInt(showcase) + 3;
                    } else if (showcase === 74) {
                        support1 = 22;
                    } else if (showcase === 75) {
                        support1 = 58;
                        support2 = 59;
                    }


                    if (support2 === null && support1 !== null) {
                        support2 = support1;
                        support1 = null;
                    }

                    if ((showcase < 3 || showcase > 4) && showcase !== 70) {
                        video1 = 70;
                    } else {
                        video1 = 29;
                    }
                    if (showcase < 15 || showcase > 17) {
                        video2 = 16;
                    } else {
                        video2 = 29;
                    }
                    if (showcase < 38 || showcase > 40) {
                        video3 = 39;
                    } else {
                        video3 = 29;
                    }

                    addVideo2(video1, "top", 1);
                    addVideo2(video2, "top", 1);
                    addVideo2(video3, "top", 1);

                    var div = document.getElementById("showcase");
                    addVideo2(showcase, "showcase", 3);

                    if (support1 === null) {
                        if (showcase !== 1)
                            addVideo2(2, "right", 1);
                        else
                            addVideo2(29, "right", 1);
                        addVideo2(10, "right", 1);

                        div.appendChild(document.createElement("br"));
                        addVideo2(23, "right", 1);
                        addVideo2(35, "right", 1);
                        div.appendChild(document.createElement("br"));
                    } else {
                        addVideo2(support1, "right", 2);
                    }
                    if (support2 !== null)
                        addVideo2(support2, "right", 2);
                } else {
                    if (maxVids >= 10)
                        addVideo(2);
                    addVideo(70);
                    if (maxVids >= 18)
                        addVideo(69);
                    if (maxVids >= 5)
                        addVideo(6);
                    if (maxVids >= 8)
                        addVideo(8);
                    if (maxVids >= 7)
                        addVideo(10);
                    if (maxVids >= 11)
                        addVideo(13);
                    addVideo(16);
                    if (maxVids >= 9)
                        addVideo(18);
                    if (maxVids >= 20)
                        addVideo(55);
                    if (maxVids >= 6)
                        addVideo(20);
                    if (maxVids >= 17)
                        addVideo(23);
                    if (maxVids >= 15)
                        addVideo(26);
                    if (maxVids >= 12)
                        addVideo(35);
                    addVideo(39);
                    if (maxVids >= 16)
                        addVideo(44);
                    if (maxVids >= 13)
                        addVideo(50);
                    addVideo(29);
                    if (maxVids >= 14)
                        addVideo(31);
                    if (maxVids >= 19)
                        addVideo(88);
                }
            }

            function addSnapshot(id) {
                var snapshot = document.createElement("img");
                snapshot.id = "knoxville-" + id;
                var srcStr = "https://tnsnapshots.com/thumbs/R1_";
                if (id < 100)
                    srcStr = srcStr + "0";
                if (id < 10)
                    srcStr = srcStr + "0";
                srcStr = srcStr + id + ".flv.png";
                snapshot.src = srcStr;
                snapshot.style.width = 320;
                snapshot.style.height = 240;

                var link = document.createElement("a");
                link.href = 'index.html?showcase=' + id;
                link.appendChild(snapshot);

                document.body.appendChild(link);
            }

            function addVideo(id) {
                var video = document.createElement("video-js");
                video.id = "knoxville-" + id;
                var source = document.createElement("source");

                var srcStr = "https://mcleansfs";

                if (id <= 9)
                    srcStr = srcStr + "5";
                else if (id <= 19)
                    srcStr = srcStr + "1";
                else if (id <= 29)
                    srcStr = srcStr + "2";
                else if (id <= 39)
                    srcStr = srcStr + "3";
                else if (id <= 49)
                    srcStr = srcStr + "4";
                else if (id <= 59)
                    srcStr = srcStr + "5";
                else if (id === 70 || id === 71 || id === 72 || id === 73 || id === 74 || id === 75)
                    srcStr = srcStr + "2";
                else if (id === 100 || id === 101)
                    srcStr = srcStr + "2";
                else if (id === 79 || id === 80 || id === 82 || id === 93)
                    srcStr = srcStr + "3";
                else if (id === 84)
                    srcStr = srcStr + "5";
                else if (id >= 206 && id <= 210)
                    srcStr = srcStr + "3";
                else if (id === 86 || id === 87)
                    srcStr = srcStr + "2";
                else
                    srcStr = srcStr + "1";

                srcStr = srcStr + ".us-east-1.skyvdn.com/rtplive/R1_";
                if (id < 100)
                    srcStr = srcStr + "0";
                if (id < 10)
                    srcStr = srcStr + "0";
                srcStr = srcStr + id;
                srcStr = srcStr + "/playlist.m3u8";
                source.src = srcStr;

                video.appendChild(source);
                video.onclick = function () {
                    window.location.href = 'index.html?showcase=' + id;
                };
                var mainDiv = document.getElementById('main');
                mainDiv.appendChild(video);
                videojs('knoxville-' + id);
            }

            function addVideo2(id, region, scale) {
                var video = document.createElement("video-js");
                video.id = 'video' + id;
                var source = document.createElement("source");
                // Build source string
                var srcStr = "https://mcleansfs";

                if (id <= 9)
                    srcStr = srcStr + "5";
                else if (id <= 19)
                    srcStr = srcStr + "1";
                else if (id <= 29)
                    srcStr = srcStr + "2";
                else if (id <= 39)
                    srcStr = srcStr + "3";
                else if (id <= 49)
                    srcStr = srcStr + "4";
                else if (id <= 59)
                    srcStr = srcStr + "5";
                else if (id === 70 || id === 71 || id === 72 || id === 73 || id === 74 || id === 75)
                    srcStr = srcStr + "2";
                else if (id === 100 || id === 101)
                    srcStr = srcStr + "2";
                else if (id === 79 || id === 80 || id === 82 || id === 93)
                    srcStr = srcStr + "3";
                else if (id === 84)
                    srcStr = srcStr + "5";
                else if (id >= 206 && id <= 210)
                    srcStr = srcStr + "3";
                else if (id === 86 || id === 87)
                    srcStr = srcStr + "2";
                else
                    srcStr = srcStr + "1";

                srcStr = srcStr + ".us-east-1.skyvdn.com/rtplive/R1_";
                if (id < 100)
                    srcStr = srcStr + "0";
                if (id < 10)
                    srcStr = srcStr + "0";
                srcStr = srcStr + id;
                srcStr = srcStr + "/playlist.m3u8";
                source.src = srcStr;
                video.appendChild(source);
                if (region === "showcase")
                    video.onclick = function () {
                        location.href = 'index.html';
                    };
                else
                    video.onclick = function () {
                        location.href = 'index.html?showcase=' + id;
                    };
                var div = document.getElementById(region);
                div.appendChild(video);
                videojs('video' + id, {width: width * scale, height: height * scale});
            }
        </script>
    </head>
    <body onLoad="startPlayers()" onResize="location.reload()">
        <iframe id="incidents" src="https://smartway.tn.gov/traffic/text/region/1/incidents" sandbox="allow-scripts allow-same-origin"></iframe>
        <h1>Knox County TN Traffic Center</h1>
        <div id="main"></div>
        <div id="left">
            <div id="top">
            </div>
            <div id="showcase">
            </div>
        </div>

        <div id="right">
        </div>

        <div id="bottom">
        </div>

        <script src="js/video.min.js"></script>
    </body>
